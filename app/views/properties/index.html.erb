<%= render partial: "modal_form" %>
<div class='table-page-header'>
  <button type="button" style="float: right; background: white" data-toggle="modal" data-target="#property-form-modal""> Add Property</button>
  <h5 class="dashboard-title">Properties (<%= @active_properties.count %> Active)</h5>
</div>

<div class='form-container status-dropdown'>	
	<%= form_tag(properties_path, :method => "get", id: "search-form") do %>	
		<%= select_tag :status, options_for_select([['Active', 'active'], ['Inactive', 'inactive']], @status), {:include_blank => "Filter by status", :onchange => "this.form.submit();", :class => "form-group"} %>	
	<% end %>	
</div>
<div class="table-responsive">
	<table class="table table-bordered"id="sortable-table" cellspacing="0" width="100%">
		<thead class="thead-default">
			<tr>
				<th>Legal Name</th>
				<th>Nickname</th>
				<th>Closing Date</th>
				<th>Address</th>
				<th>City</th>
				<th>State</th>
				<th>Status</th>
				<th>Sale Date</th>
				<th>Deal Equity</th>
			</tr>
		</thead>
		<tbody>
			<% @properties.each do |prop| %>
				<tr>
					<td><%= link_to prop.name.strip, property_path(prop.id) %></td>
					<td><%= prop.nickname %></td>
					<td><%= prop&.closing_date&.strftime("%m-%d-%Y") %></td>
					<td><%= prop&.address&.line1 %></td>
					<td><%= prop&.address&.city %></td>
					<td><%= prop&.address&.state %></td>
					<td><%= prop&.status&.capitalize %></td>
					<td><%= prop&.deals&.first&.date %></td>
					<td><%= number_to_currency(prop.deal_equity, precision: 0) %></td>
				</tr>
			<% end %>
		</tbody>
	</table>
</div>

<script>
  $(document).ready(function() {
    $('#sortable-table').DataTable({
      "paging": true,
      "info": false,
			"order": [[3, "desc"]],
			"columnDefs": [{ "searchable": false, "targets": [2,3,4,5,6,7,8] }],
			"language": {
				"zeroRecords": "There are no properties that match your search.",
				searchPlaceholder: "Legal name or nickname",
				search: "",
			}
		});

		$('#search-form').keydown(function(event) {
			if (event.keyCode == 13) {
				$('#search-form').submit();
				return false
			}
		});
	});
</script>