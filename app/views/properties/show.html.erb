<%= render partial: "modal_form", property: @property %>
<div class="container-fluid" style="margin-top: 58px">
	<div class="row page-header">
		<div class="col-md-2">
      <% if @property&.avatar&.attachment  %>
        <%= image_tag url_for(@property.avatar), alt: "Property Image", style: 'width: 100%; height: 100%' %>
      <% else %>
			  <img alt="Property Image" src="#{url_for(@property.avatar)}" />
      <% end %>
		</div>
		<div class="col-md-5">
			<h3 class="text-left">
				<%= @property.name %>
			</h3> 
			<address>
				 <strong><%= @property.name %></strong><br /> <%= @property&.address&.line1 %><br /> <%= @property&.address&.location %>
			</address>
      <div><strong>Created At: </strong> <%= @property.created_at.strftime("%B %d, %Y") %> </div>
      <div><strong>Updated At: </strong> <%= @property.updated_at.strftime("%B %d, %Y") %> </div>
      <div><strong>Status: </strong> <%= @property.status&.capitalize %> </div>
		</div>
		<div class="col-md-5" style="text-align: right">
			 
      <button type="button" style="width: 100px ;background: white" data-toggle="modal" data-target="#property-form-modal""> Edit </button>

      <div><strong>Closing Date: </strong> <%= @property.closing_date&.strftime("%B %d, %Y") %> </div>
      <div><strong>Investor Equity: </strong> <%= number_to_currency(@property&.deal_equity, precision: 0) %> </div>
      <% if !@property.gross_distributions.blank? %><div><strong>Gross Distributions: </strong> <%= number_to_currency(@property.gross_distributions, precision: 0) %></div><% end  %>
      <div><strong>Sale Date: </strong> <%= @property.sale_date&.strftime("%B %d, %Y") %> </div>
      <% if !@property.internal_rate_of_return.blank? %><div><strong>Internal Rate of Return: </strong> <%= @property.internal_rate_of_return %>%</div><% end  %>
      <% if !@property.equity_multiple.blank? %><div><strong>Equity Multiple: </strong> <%= @property.equity_multiple %></div><% end  %>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<div class="table-page-header">
				<span style="font-size: 24px; font-weight: 500">Investors</span>
        <button type="button" style="width: 100px ;background: white; float:right" data-toggle="modal" data-target="#investor-import-modal"">Import</button>
			</div>
    </div>
  </div>
  <% if !@property&.investments.nil? %>
    <div class="table-responsive">
      <table class="table table-bordered investor-table" id="sortable-table" cellspacing="0" width="100%">
        <thead class="thead-default">
          <tr>
            <th>
              Name
            </th>
            <th>
              Email
            </th>
            <th>
              Investor Entity
            </th>
            <th>
              Investment Entity
            </th>
            <th>
              Investment
            </th>
          </tr>
        </thead>
        <tbody>
          <% @property&.investments.each do |invst| %>
            <tr class="investor-table">
              <td>
                <% if invst.user_id  %>
                  <%= link_to "#{invst&.investor_first_name} #{invst&.investor_last_name}", investor_show_path(invst.user_id) %>
                <% else %>
                  <%= "#{invst&.investor_first_name} #{invst&.investor_last_name}" %>
                <% end %>
              </td>
              <td>
                <%= invst.investor_email %>
              </td>
              <td>
                <%= invst.investing_entity %>
              </td>
              <td>
                <%= invst&.deal&.title %>
              </td>
              <td>
                <%= number_to_currency(invst.amount_invested, precision: 0) %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    No Investments on this Property.
  <% end %>
</div>

<script>
  $(document).ready(function() {
    $('#sortable-table').DataTable({
      "paging": true,
      "info": false,
      "columnDefs": [{ "searchable": false, "targets": [1,3] }],
      "deferRender" : true,
			"language": {
				"zeroRecords": "There are no search results.",
				searchPlaceholder: "Name or investment entity",
				search: "",
			}
    });
  });
</script>