<%= render partial: "modal_form", property: @property %>
<div id="investment-form-modal"></div>
<div class="container-fluid" style="margin-top: 58px">
	<div class="row page-header">
		<div class="col-md-2">
      <% if @property&.avatar&.attachment  %>
        <%= image_tag url_for(@property.avatar), alt: "Property Image", style: 'width: 100%; height: 100%' %>
      <% else %>
			  <img alt="Property Image" src="#{url_for(@property.avatar)}" />
      <% end %>
		</div>
		<div class="col-md-5">
			<h3 class="text-left">
				<%= @property.name %>
			</h3> 
			<address>
				 <strong><%= @property.name %></strong><br /> <%= @property&.address&.line1 %><br /> <%= @property&.address&.location %>
			</address>
      <div><strong>Created At: </strong> <%= @property.created_at.strftime("%B %d, %Y") %> </div>
      <div><strong>Updated At: </strong> <%= @property.updated_at.strftime("%B %d, %Y") %> </div>
      <% if @property.status %><div><strong>Status: </strong> <%= @property.status&.capitalize %> </div><% end %>
      <% if @property.property_type %><div><strong>Property Type: </strong> <%= @property&.property_type&.humanize %> </div><% end %>
      <% if @property.description %><div><strong>Description: </strong> <%= @property.description %></div><% end %>
		</div>
		<div class="col-md-5" style="text-align: right">
			 
      <button type="button" style="width: 100px ;background: white" data-toggle="modal" data-target="#property-form-modal""> Edit </button>

      <% if @property.closing_date %><div><strong>Closing Date: </strong> <%= @property.closing_date&.strftime("%B %d, %Y") %> </div><% end %>
      <% if @property.deal_equity %><div><strong>Investor Equity: </strong> <%= number_to_currency(@property&.deal_equity, precision: 0) %> </div><% end %>
      <% if !@property.gross_distributions.blank? %><div><strong>Gross Distributions: </strong> <%= number_to_currency(@property.gross_distributions, precision: 0) %></div><% end %>
      <% if @property.sale_date %><div><strong>Sale Date: </strong> <%= @property.sale_date&.strftime("%B %d, %Y") %> </div><% end %>
      <% if !@property.internal_rate_of_return.blank? %><div><strong>Internal Rate of Return: </strong> <%= @property.internal_rate_of_return %>%</div><% end %>
      <% if !@property.equity_multiple.blank? %><div><strong>Equity Multiple: </strong> <%= @property.equity_multiple %></div><% end %>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<div class="table-page-header">
				<span style="font-size: 24px; font-weight: 500">Investors</span>
        <button type="button" style="width: 100px ;background: white; float:right" data-toggle="modal" data-target="#investor-import-modal"">Import</button>
			</div>
    </div>
  </div>
  <% if !@property&.investments.nil? %>
    <div class="table-responsive">
      <table class="table table-bordered investor-table" id="sortable-table" cellspacing="0" width="100%">
        <thead class="thead-default">
          <tr>
            <th>
              Name
            </th>
            <th>
              Email
            </th>
            <th>
              Investor Entity
            </th>
            <th>
              Investment Entity
            </th>
            <th>
              Investment
            </th>
            <th>
              Gross Distributions
            </th>
            <th>
              
            </th>
          </tr>
        </thead>
        <tbody>
          <% @property&.investments.each do |invst| %>
            <tr class="investor-table">
              <td>
                <% if invst.user_id  %>
                  <%= link_to "#{invst&.investor_first_name} #{invst&.investor_last_name}", investor_show_path(invst.user_id) %>
                <% else %>
                  <%= "#{invst&.investor_first_name} #{invst&.investor_last_name}" %>
                <% end %>
              </td>
              <td>
                <%= invst.investor_email %>
              </td>
              <td>
                <%= invst.investor_entity %>
              </td>
              <td>
                <%= invst&.deal&.title %>
              </td>
              <td>
                <%= number_to_currency(invst.amount_invested, precision: 0) %>
              </td>
              <td>
                <%= invst&.gross_distribution %>
              </td>
              <td>
                <%= link_to 'Edit',  '#', 'data-target' => "#myModal_#{invst.id}", 'data-toggle' => 'modal'  %>
                <div class="modal fade" id='<%= "myModal_#{invst.id}" %>' tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel">Update Investment</h4>
                      </div>
                      <div class="modal-body">
                        <%= form_for invst do |f| %>
                          <fieldset class="form-group">
                            <label>Property</label>
                            <%= select :property, :id, Property.all.map {|property| ["#{property.name}", property.id]}, prompt: 'Select property...', required: true %>
                          </fieldset>
                          <fieldset class="form-group">
                            <label>Investor Entity<span style="color:red">*</span></label>
                            <%= f.text_field :investor_entity, value: invst.investor_entity, required: true %>
                          </fieldset>

                          <fieldset class="form-group">
                            <label>Investment Entity<span style="color:red">*</span></label>
                            <%= f.text_field :investing_entity, value: invst.investing_entity %>
                          </fieldset>

                          <fieldset class="form-group">
                            <label>Investment</label>
                            <%= f.text_field :amount_invested, value: invst.amount_invested %>
                          </fieldset>

                          <fieldset class="form-group">
                            <label>Gross Distribution</label>
                            <%= f.text_field :gross_distribution, value: invst.gross_distribution %>
                          </fieldset>

                          <%= f.submit class: "btn btn-primary", id: "submit" %>

                        <% end %>
                      </div>
                    </div><!-- /.modal-content -->
                  </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    No Investments on this Property.
  <% end %>
</div>

<script>

  $(document).ready(function() {
    $('#sortable-table').DataTable({
      "paging": true,
      "info": false,
      "columnDefs": [{ "searchable": false, "targets": [1,3] }],
      "deferRender" : true,
			"language": {
				"zeroRecords": "There are no search results.",
				searchPlaceholder: "Name or investment entity",
				search: "",
			}
    });
  });
</script>